## Refazendo simulacoes IC com modelo atual (mestrado)

sim_ic_atual_1<-simula.neutra.step(100,10,10,5,0,0,1000000,100)
sim_ic_atual_2<-simula.neutra.step(100,10,10,5,0,0,100000,100)
lista<-list(sim_ic_atual_1,sim_ic_atual_2)
lista_output<-simula_output(lista)

#com menos especies pra ver se vira r...
sim_ic_atual_3<-simula.neutra.step(50,20,10,5,0,0,100000,100)
sim_ic_atual_4<-simula.neutra.step(25,40,10,5,0,0,100000,100)
sim_ic_atual_5<-simula.neutra.step(10,100,10,5,0,0,100000,100)
sim_ic_atual_6<-simula.neutra.step(5,200,10,5,0,0,100000,100)
sim_ic_atual_7<-simula.neutra.step(2,500,10,5,0,0,100000,100)
sim_ic_atual_0<-simula.neutra.step(1000,1,10,5,0,0,100000,100) #de fato, neste caso a media eh bem mais "r" do que "k". Mas suspeito que seja por conta do tempo corrido, que aqui foi menor.
lista2<-list(sim_ic_atual_0,sim_ic_atual_2,sim_ic_atual_3,sim_ic_atual_4,sim_ic_atual_5,sim_ic_atual_6,sim_ic_atual_7)
lista2_output<-simula_output(lista2)
lista2_output

### mudando a funcao simula_output para olhar um tempo fixo igual pra todo mundo

simula_output<-function(lista_simulacoes)
{
  x<-lista_simulacoes
  resultado<-matrix()
  resultado_lista<-list()
  for (i in 1:length(x))
  {
    abund<-as.vector(table(x[[i]]$sp.list[,1001]))
    tam_com<-sum(abund)
    prop <- as.matrix(x[[i]]$sementes)
    sp <- as.matrix(x[[i]]$sp.list)
    med_geral <- mean(prop[,1001])
    med_sp <- tapply(X=prop[,1001],INDEX=sp[,1001],FUN=mean)
    vari_geral <- var(prop[,1001])
    vari_sp <- tapply(X=prop[,1001],INDEX=sp[,1001],FUN=var)
    assim_geral <- skewness(prop[,1001])
    assim_sp <- tapply(X=prop[,1001],INDEX=sp[,1001],FUN=skewness)
    curt_geral <- kurtosis(prop[,1001],method="excess")
    curt_sp <- tapply(X=prop[,1001],INDEX=sp[,1001],FUN=kurtosis)
    curt_geral_corrigida <- assim_geral^2 - curt_geral
    curt_sp_corrigida <- assim_sp^2-curt_sp
    resultado <- matrix(data=c(tam_com,abund,med_geral,med_sp,vari_geral,vari_sp,assim_geral,assim_sp,curt_geral,curt_sp,curt_geral_corrigida,curt_sp_corrigida),ncol=6,dimnames=list(c("geral",paste("sp",(unique(sp[,1001])[order(unique(sp[,1001]))]),sep="")),c("abundancia","media","variancia","assimetria","curtose","curtose_corrigida")))
    attributes(resultado)$start<-attributes(x[[i]])
    resultado_lista[[i]]<-resultado
  }
  return(resultado_lista)
}

lista2_output_sem_meia_vida<-simula_output(lista2)

save(lista,lista_output,lista2,lista2_output,lista2_output_sem_meia_vida,sim_ic_atual_0,sim_ic_atual_1,sim_ic_atual_2,sim_ic_atual_3,sim_ic_atual_4,sim_ic_atual_5,sim_ic_atual_6,sim_ic_atual_7,simula_output,simula.neutra.step,file="sim_ic_refeitas.RData")


########### Testando a funcao alterada de simula_output com os dados do mestrado
load("sim_25mar16_4.RData")
sim_4_output_novo<-simula_output(simulacoes_25mar16_4)
rm(simulacoes_25mar16_4)
load("sim_25mar16_5.RData")
sim_5_output_novo<-simula_output(simulacoes_25mar16_5)
rm(simulacoes_25mar16_5)
load("sim_25mar16_6.RData")
sim_6_output_novo<-simula_output(simulacoes_25mar16_6)
rm(simulacoes_25mar16_6)
load("sim_25mar16_7.RData")
sim_7_output_novo<-simula_output(simulacoes_25mar16_7)
rm(simulacoes_25mar16_7)
load("sim_25mar16_8.RData")
sim_8_output_novo<-simula_output(simulacoes_25mar16_8)
rm(simulacoes_25mar16_8)
load("sim_25mar16_9.RData")
sim_9_output_novo<-simula_output(simulacoes_25mar16_9)
rm(simulacoes_25mar16_9)
load("sim_25mar16_10.RData")
sim_10_output_novo<-simula_output(simulacoes_25mar16_10)
rm(simulacoes_25mar16_10)
load("sim_25mar16_11.RData")
sim_11_output_novo<-simula_output(simulacoes_25mar16_11)
rm(simulacoes_25mar16_11)
load("sim_25mar16_12.RData")
sim_12_output_novo<-simula_output(simulacoes_25mar16_12)
rm(simulacoes_25mar16_12)
load("sim_25mar16_12.RData")
sim_12_output_novo<-simula_output(simulacoes_25mar16_12)
rm(simulacoes_25mar16_12)
load("sim_25mar16_13.RData")
sim_13_output_novo<-simula_output(simulacoes_25mar16_13)
rm(simulacoes_25mar16_13)
load("sim_25mar16_14.RData")
sim_14_output_novo<-simula_output(simulacoes_25mar16_14)
rm(simulacoes_25mar16_14)
load("sim_25mar16_15.RData")
sim_15_output_novo<-simula_output(simulacoes_25mar16_15)
rm(simulacoes_25mar16_15)
load("sim_25mar16_16.RData")
sim_16_output_novo<-simula_output(simulacoes_25mar16_16)
rm(simulacoes_25mar16_16)
load("sim_25mar16_17.RData")
sim_17_output_novo<-simula_output(simulacoes_25mar16_17)
rm(simulacoes_25mar16_17)
load("sim_25mar16_18.RData")
sim_18_output_novo<-simula_output(simulacoes_25mar16_18)
rm(simulacoes_25mar16_18)
load("sim_25mar16_19.RData")
sim_19_output_novo<-simula_output(simulacoes_25mar16_19)
rm(simulacoes_25mar16_19)
load("sim_25mar16_20.RData")
sim_20_output_novo<-simula_output(simulacoes_25mar16_20)
rm(simulacoes_25mar16_20)
load("sim_25mar16_21.RData")
sim_21_output_novo<-simula_output(simulacoes_25mar16_21)
rm(simulacoes_25mar16_21)
load("sim_25mar16_22.RData")
sim_22_output_novo<-simula_output(simulacoes_25mar16_22)
rm(simulacoes_25mar16_22)
load("sim_25mar16_23.RData")
sim_23_output_novo<-simula_output(simulacoes_25mar16_23)
rm(simulacoes_25mar16_23)
load("sim_25mar16_24.RData")
sim_24_output_novo<-simula_output(simulacoes_25mar16_24)
rm(simulacoes_25mar16_24)
load("sim_25mar16_25.RData")
sim_25_output_novo<-simula_output(simulacoes_25mar16_25)
rm(simulacoes_25mar16_25)
load("sim_25mar16_26.RData")
sim_26_output_novo<-simula_output(simulacoes_25mar16_26)
rm(simulacoes_25mar16_26)
load("sim_25mar16_27.RData")
sim_27_output_novo<-simula_output(simulacoes_25mar16_27)
rm(simulacoes_25mar16_27)
load("sim_25mar16_28.RData")
sim_28_output_novo<-simula_output(simulacoes_25mar16_28)
rm(simulacoes_25mar16_28)
load("sim_25mar16_29.RData")
sim_29_output_novo<-simula_output(simulacoes_25mar16_29)
rm(simulacoes_25mar16_29)
load("sim_25mar16_30.RData")
sim_30_output_novo<-simula_output(simulacoes_25mar16_30)
rm(simulacoes_25mar16_30)
load("sim_25mar16_31.RData")
sim_31_output_novo<-simula_output(simulacoes_25mar16_31)
rm(simulacoes_25mar16_31)
load("sim_25mar16_32.RData")
sim_32_output_novo<-simula_output(simulacoes_25mar16_32)
rm(simulacoes_25mar16_32)
load("sim_25mar16_33.RData")
sim_33_output_novo<-simula_output(simulacoes_25mar16_33)
rm(simulacoes_25mar16_33)
load("sim_25mar16_34.RData")
sim_34_output_novo<-simula_output(simulacoes_25mar16_34)
rm(simulacoes_25mar16_34)

lista_output_novo<-c(sim_1_output_novo,sim_2_output_novo,sim_3_output_novo,sim_4_output_novo,sim_5_output_novo,sim_6_output_novo,sim_7_output_novo,sim_8_output_novo,sim_9_output_novo,sim_10_output_novo,sim_11_output_novo,sim_12_output_novo,sim_13_output_novo,sim_14_output_novo,sim_15_output_novo,sim_16_output_novo,sim_17_output_novo,sim_18_output_novo,sim_19_output_novo,sim_20_output_novo,sim_21_output_novo,sim_22_output_novo,sim_23_output_novo,sim_24_output_novo,sim_25_output_novo,sim_26_output_novo,sim_27_output_novo,sim_28_output_novo,sim_29_output_novo,sim_30_output_novo,sim_31_output_novo,sim_32_output_novo,sim_33_output_novo,sim_34_output_novo)
save(lista_output_novo,file="lista_output_novo.RData")

resultados_geral_novo<-matrix(nrow=100,ncol=6,dimnames=list(c(1:100),c("Abundancia","Media","Variancia","Assimetria","Curtose","Coeficiente_Pearson")))
for(i in 1:100){
  resultados_geral_novo[i,]<-lista_output_novo[[i]][1,]
}
resulta_novo<-resultados_geral_novo[,-1]

## sensibilidade
# Media
resulta_media_novo<-as.vector(resulta_novo[,1])
pcc_media_novo<-pcc(dados3_25mar16,resulta_media_novo,nboot=50)
plot(pcc_media_novo)
abline(h=0,lty=2)
title(xlab="Parâmetros",ylab="Correlação Parcial com Média")
# Variancia
resulta_variancia_novo<-as.vector(resulta_novo[,2])
pcc_variancia_novo<-pcc(dados3_25mar16,resulta_variancia_novo,nboot=50)
plot(pcc_variancia_novo)
abline(h=0,lty=2)
title(xlab="Parâmetros",ylab="Correlação Parcial com Variância")
# Assimetria
resulta_assimetria_novo<-as.vector(resulta_novo[,3])
pcc_assimetria_novo<-pcc(dados3_25mar16,resulta_assimetria_novo,nboot=50)
plot(pcc_assimetria_novo)
abline(h=0,lty=2)
title(xlab="Parâmetros",ylab="Correlação Parcial com Assimetria")
# Curtose
resulta_curtose_novo<-as.vector(resulta_novo[,4])
pcc_curtose_novo<-pcc(dados3_25mar16,resulta_curtose_novo,nboot=50)
plot(pcc_curtose_novo)
abline(h=0,lty=2)
title(xlab="Parâmetros",ylab="Correlação Parcial com Curtose")
# Pearson
resulta_pearson_novo<-as.vector(resulta_novo[,5])
pcc_pearson_novo<-pcc(dados3_25mar16,resulta_pearson_novo,nboot=50)
plot(pcc_pearson_novo)
abline(h=0,lty=2)
title(xlab="Parâmetros",ylab="Correlação Parcial com Coeficiente de Pearson")